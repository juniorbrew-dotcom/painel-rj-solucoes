<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel de Cobran√ßa RJ Solu√ß√µes</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f4f6f8;
    }
    h2, h3 {
      color: #333;
    }
    .form, .clientes, .historico, .modelos {
      background: #fff;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-top: 10px;
      font-weight: bold;
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }
    button {
      margin-top: 10px;
      padding: 8px 12px;
      background: #0078D7;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background: #005fa3;
    }
    .btn-danger {
      background: #d9534f;
    }
    .btn-danger:hover {
      background: #b84541;
    }
    .cliente-card {
      border: 1px solid #ddd;
      padding: 10px;
      margin-top: 10px;
      border-radius: 4px;
      background: #fafafa;
    }
    .cliente-card button + button {
      margin-left: 8px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background: #f0f0f0;
    }
    .filtro-historico {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
      flex-wrap: wrap;
      align-items: center;
    }
    @media (max-width: 600px) {
      input, button, select, textarea {
        width: 100% !important;
        box-sizing: border-box;
      }
      .cliente-card {
        font-size: 14px;
      }
      table, thead, tbody, th, td, tr {
        display: block;
        width: 100%;
      }
      thead {
        display: none;
      }
      tr {
        margin-bottom: 15px;
        border: 1px solid #ddd;
        padding: 10px;
        border-radius: 5px;
        background: #fff;
      }
      td {
        border: none;
        padding: 5px 0;
        text-align: left;
      }
      td::before {
        content: attr(data-label);
        font-weight: bold;
        display: block;
        margin-bottom: 3px;
        color: #333;
      }
    }
  </style>
</head>
<body>
  <h2>Painel de Cobran√ßa RJ Solu√ß√µes</h2>
  <!-- Formul√°rio de Cadastro -->
<div class="form">
  <h3>Cadastro de Cliente</h3>

  <label for="nome">Nome do Cliente:</label>
  <input type="text" id="nome" placeholder="Ex: Jo√£o Silva">

  <label for="valor">Valor da Mensalidade:</label>
  <input type="number" id="valor" placeholder="Ex: 150">

  <label for="vencimento">Data de Vencimento:</label>
  <input type="date" id="vencimento">

  <label for="whatsapp">WhatsApp (somente n√∫meros):</label>
  <input type="text" id="whatsapp" placeholder="73999999999">

  <label for="modeloCadastro">Modelo de Mensagem:</label>
  <select id="modeloCadastro">
    <option value="lembrete-padrao">üí¨ Lembrete padr√£o</option>
    <option value="cobranca-formal">‚ö†Ô∏è Cobran√ßa formal</option>
    <option value="cobranca-direta">üìå Cobran√ßa direta</option>
    <!-- Modelos personalizados ser√£o adicionados via JavaScript -->
  </select>

  <label for="mensagemCadastro">Mensagem Gerada:</label>
  <textarea id="mensagemCadastro" rows="6" placeholder="A mensagem ser√° gerada automaticamente..."></textarea>

  <button onclick="enviarMensagemCadastro()">üì§ Enviar pelo WhatsApp</button>
  <button onclick="adicionarCliente()">üíæ Salvar Cliente</button>
</div>
<!-- Formul√°rio de Cadastro -->
<div class="form">
  <h3>Cadastro de Cliente</h3>

  <label for="nome">Nome do Cliente:</label>
  <input type="text" id="nome" placeholder="Ex: Jo√£o Silva">

  <label for="valor">Valor da Mensalidade:</label>
  <input type="number" id="valor" placeholder="Ex: 150">

  <label for="vencimento">Data de Vencimento:</label>
  <input type="date" id="vencimento">

  <label for="whatsapp">WhatsApp (somente n√∫meros):</label>
  <input type="text" id="whatsapp" placeholder="73999999999">

  <label for="modeloCadastro">Modelo de Mensagem:</label>
  <select id="modeloCadastro">
    <option value="lembrete-padrao">üí¨ Lembrete padr√£o</option>
    <option value="cobranca-formal">‚ö†Ô∏è Cobran√ßa formal</option>
    <option value="cobranca-direta">üìå Cobran√ßa direta</option>
    <!-- Modelos personalizados ser√£o adicionados via JavaScript -->
  </select>

  <label for="mensagemCadastro">Mensagem Gerada:</label>
  <textarea id="mensagemCadastro" rows="6" placeholder="A mensagem ser√° gerada automaticamente..."></textarea>

  <button onclick="enviarMensagemCadastro()">üì§ Enviar pelo WhatsApp</button>
  <button onclick="adicionarCliente()">üíæ Salvar Cliente</button>
</div>
<div class="cliente-card">
  <p><strong>Nome:</strong> Jo√£o Silva</p>
  <p><strong>Valor:</strong> R$ 150,00</p>
  <p><strong>Vencimento:</strong> 10/09/2025</p>
  <p><strong>WhatsApp:</strong> 73999999999</p>
  <button>Enviar Mensagem</button>
  <button>Editar</button>
  <button>Excluir</button>
  <button>Editar Mensagem</button>
</div>
<div class="cliente-card">
  <p><strong>Nome:</strong> Jo√£o Silva</p>
  <p><strong>Valor:</strong> R$ 150,00</p>
  <p><strong>Vencimento:</strong> 10/09/2025</p>
  <p><strong>WhatsApp:</strong> 73999999999</p>
  <button>Enviar Mensagem</button>
  <button>Editar</button>
  <button>Excluir</button>
  <button>Editar Mensagem</button>
</div>
<!-- Modelos Personalizados -->
<div class="modelos">
  <h3>Meus Modelos Personalizados</h3>

  <label for="nomeModelo">Nome do Modelo:</label>
  <input type="text" id="nomeModelo" placeholder="Ex: Cobran√ßa com emoji">

  <label for="textoModelo">Texto do Modelo:</label>
  <textarea id="textoModelo" rows="6" placeholder="Use {NOME}, {VALOR}, {VENCIMENTO} para campos din√¢micos"></textarea>

  <label for="categoriaModelo">Categoria:</label>
  <select id="categoriaModelo">
    <option value="lembrete">üí¨ Lembrete</option>
    <option value="cobranca">‚ö†Ô∏è Cobran√ßa</option>
    <option value="acordo">üìå Acordo</option>
    <option value="informativo">üßæ Informativo</option>
  </select>

  <label for="corModelo">Cor de fundo:</label>
  <input type="color" id="corModelo" value="#f9f9f9">

  <button onclick="salvarModeloPersonalizado()">üíæ Salvar Modelo</button>

  <div id="listaModelosPersonalizados"></div>
</div>
<!-- Hist√≥rico de Envios -->
<div class="historico">
  <h3>Hist√≥rico de Envios</h3>

  <div class="filtro-historico">
    <label for="filtroInicio">De:</label>
    <input type="date" id="filtroInicio">

    <label for="filtroFim">At√©:</label>
    <input type="date" id="filtroFim">

    <button onclick="filtrarHistorico()">üîç Filtrar</button>
    <button onclick="limparFiltro()">üßπ Limpar</button>
  </div>

  <table>
    <thead>
      <tr>
        <th>Nome</th>
        <th>Valor</th>
        <th>Vencimento</th>
        <th>WhatsApp</th>
        <th>Tipo</th>
        <th>Data/Hora</th>
      </tr>
    </thead>
    <tbody id="tabelaHistorico"></tbody>
  </table>

  <div class="historico-buttons">
    <button onclick="exportarCSV()">üìÅ Exportar CSV</button>
    <button onclick="limparHistorico()">üóëÔ∏è Limpar Hist√≥rico</button>
  </div>
</div>
<script>
// Utilit√°rios
function parseBRDateToISO(br) {
  if (!br) return "";
  const [d, m, y] = br.split("/");
  return `${y}-${m}-${d}`;
}
function startOfDay(date) {
  const d = new Date(date);
  d.setHours(0, 0, 0, 0);
  return d;
}
function toBRL(n) {
  return Number(n).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
}
function onlyDigits(s) {
  return (s || "").replace(/\D/g, "");
}
  <script>
// Utilit√°rios
function parseBRDateToISO(br) {
  if (!br) return "";
  const [d, m, y] = br.split("/");
  return `${y}-${m}-${d}`;
}
function startOfDay(date) {
  const d = new Date(date);
  d.setHours(0, 0, 0, 0);
  return d;
}
function toBRL(n) {
  return Number(n).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
}
function onlyDigits(s) {
  return (s || "").replace(/\D/g, "");
}
  <script>
// Utilit√°rios
function parseBRDateToISO(br) {
  if (!br) return "";
  const [d, m, y] = br.split("/");
  return `${y}-${m}-${d}`;
}
function startOfDay(date) {
  const d = new Date(date);
  d.setHours(0, 0, 0, 0);
  return d;
}
function toBRL(n) {
  return Number(n).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
}
function onlyDigits(s) {
  return (s || "").replace(/\D/g, "");
}
  // Modelos prontos
const modelos = {
  lembrete: [
    {
      nome: "Lembrete padr√£o",
      texto: `Ol√° {NOME}, sua mensalidade de {VALOR} vence em {VENCIMENTO}.\nPIX: 11370535000170\nEnvie o comprovante para (73) 99927-2550`
    },
    {
      nome: "Lembrete cordial",
      texto: `Prezado(a) {NOME}, estamos passando para lembrar que sua mensalidade de {VALOR} vence em {VENCIMENTO}.\nCaso j√° tenha efetuado o pagamento, por favor desconsidere este aviso.\nPIX: 11370535000170`
    }
  ],
  cobranca: [
    {
      nome: "Cobran√ßa formal",
      texto: `Prezado(a) {NOME}, identificamos pend√™ncia na mensalidade de {VALOR}, vencida em {VENCIMENTO}.\nSolicitamos a regulariza√ß√£o imediata.\nPIX: 11370535000170`
    },
    {
      nome: "Cobran√ßa direta",
      texto: `Ol√° {NOME}, sua mensalidade de {VALOR} venceu em {VENCIMENTO}.\nPor favor, envie o comprovante via WhatsApp: (73) 99927-2550\nPIX: 11370535000170`
    }
  ]
};

function carregarModelo() {
  const tipo = document.getElementById("tipoModelo").value;
  const seletor = document.getElementById("modeloSelecionado");
  seletor.innerHTML = "";

  modelos[tipo].forEach((m, i) => {
    const opt = document.createElement("option");
    opt.value = i;
    opt.textContent = m.nome;
    seletor.appendChild(opt);
  });

  preencherTextoModelo();
}

function preencherTextoModelo() {
  const tipo = document.getElementById("tipoModelo").value;
  const index = document.getElementById("modeloSelecionado").value;
  const modelo = modelos[tipo][index];

  const cliente = obterClienteSelecionado();
  if (!cliente) {
    document.getElementById("mensagemEditavel").value = modelo.texto;
    return;
  }

  const texto = modelo.texto
    .replaceAll("{NOME}", cliente.nome)
    .replaceAll("{VALOR}", cliente.valor)
    .replaceAll("{VENCIMENTO}", cliente.vencimento);

  document.getElementById("mensagemEditavel").value = texto;
}

function enviarMensagemEditada() {
  const cliente = obterClienteSelecionado();
  if (!cliente) {
    alert("Selecione um cliente primeiro.");
    return;
  }

  const texto = document.getElementById("mensagemEditavel").value;
  const whatsapp = onlyDigits(cliente.whatsapp);
  const url = `https://wa.me/55${whatsapp}?text=${encodeURIComponent(texto)}`;
  window.open(url, "_blank");

  const tipo = startOfDay(new Date(parseBRDateToISO(cliente.vencimento))) < startOfDay(new Date()) ? "cobranca" : "lembrete";
  const dataHora = new Date().toLocaleString("pt-BR");
  renderHistorico(cliente.nome, cliente.valor, cliente.vencimento, cliente.whatsapp, tipo, dataHora);
  salvarHistorico();
}

let clienteSelecionado = null;
function obterClienteSelecionado() {
  return clienteSelecionado;
}
function selecionarCliente(botao) {
  const card = botao.parentElement;
  clienteSelecionado = {
    nome: card.querySelector(".nome").textContent,
    valor: card.querySelector(".valor").textContent,
    vencimento: card.querySelector(".vencimento").textContent,
    whatsapp: card.querySelector(".whats").textContent
  };
  preencherTextoModelo();
}
  const icones = {
  lembrete: "üí¨",
  cobranca: "‚ö†Ô∏è",
  acordo: "üìå",
  informativo: "üßæ"
};

function salvarModeloPersonalizado() {
  const nome = document.getElementById("nomeModelo").value.trim();
  const texto = document.getElementById("textoModelo").value.trim();
  const categoria = document.getElementById("categoriaModelo").value;
  const cor = document.getElementById("corModelo").value;

  if (!nome || !texto) {
    alert("Preencha o nome e o texto do modelo.");
    return;
  }

  const modelosSalvos = JSON.parse(localStorage.getItem("modelosPersonalizados")) || [];
  modelosSalvos.push({ nome, texto, categoria, cor });
  localStorage.setItem("modelosPersonalizados", JSON.stringify(modelosSalvos));

  document.getElementById("nomeModelo").value = "";
  document.getElementById("textoModelo").value = "";
  listarModelosPersonalizados();
  atualizarModelosCadastro();
}

function listarModelosPersonalizados() {
  const container = document.getElementById("listaModelosPersonalizados");
  container.innerHTML = "";

  const modelosSalvos = JSON.parse(localStorage.getItem("modelosPersonalizados")) || [];

  modelosSalvos.forEach((modelo, index) => {
    const div = document.createElement("div");
    div.style.border = "1px solid #ccc";
    div.style.padding = "10px";
    div.style.marginTop = "10px";
    div.style.borderRadius = "5px";
    div.style.background = modelo.cor || "#f9f9f9";

    div.innerHTML = `
      <strong>${icones[modelo.categoria] || ""} ${modelo.nome}</strong>
      <pre style="white-space: pre-wrap; margin-top: 5px;">${modelo.texto}</pre>
      <button onclick="aplicarModeloPersonalizado(${index})">Selecionar</button>
      <button onclick="editarModeloPersonalizado(${index})">Editar</button>
      <button onclick="excluirModeloPersonalizado(${index})" class="btn-danger">Excluir</button>
    `;

    container.appendChild(div);
  });
}

function aplicarModeloPersonalizado(index) {
  const modelosSalvos = JSON.parse(localStorage.getItem("modelosPersonalizados")) || [];
  const modelo = modelosSalvos[index];

  const cliente = obterClienteSelecionado();
  let texto = modelo.texto;

  if (cliente) {
    texto = texto
      .replaceAll("{NOME}", cliente.nome)
      .replaceAll("{VALOR}", cliente.valor)
      .replaceAll("{VENCIMENTO}", cliente.vencimento);
  }

  document.getElementById("mensagemEditavel").value = texto;
}

function editarModeloPersonalizado(index) {
  const modelosSalvos = JSON.parse(localStorage.getItem("modelosPersonalizados")) || [];
  const modelo = modelosSalvos[index];

  document.getElementById("nomeModelo").value = modelo.nome;
  document.getElementById("textoModelo").value = modelo.texto;
  document.getElementById("categoriaModelo").value = modelo.categoria;
  document.getElementById("corModelo").value = modelo.cor;

  modelosSalvos.splice(index, 1);
  localStorage.setItem("modelosPersonalizados", JSON.stringify(modelosSalvos));
  listarModelosPersonalizados();
  atualizarModelosCadastro();
}

function excluirModeloPersonalizado(index) {
  if (confirm("Deseja excluir este modelo?")) {
    const modelosSalvos = JSON.parse(localStorage.getItem("modelosPersonalizados")) || [];
    modelosSalvos.splice(index, 1);
    localStorage.setItem("modelosPersonalizados", JSON.stringify(modelosSalvos));
    listarModelosPersonalizados();
    atualizarModelosCadastro();
  }
}

function atualizarModelosCadastro() {
  const seletor = document.getElementById("modeloCadastro");
  if (!seletor) return;

  seletor.innerHTML = `
    <option value="lembrete-padrao">üí¨ Lembrete padr√£o</option>
    <option value="cobranca-formal">‚ö†Ô∏è Cobran√ßa formal</option>
    <option value="cobranca-direta">üìå Cobran√ßa direta</option>
  `;

  const personalizados = JSON.parse(localStorage.getItem("modelosPersonalizados")) || [];
  personalizados.forEach((modelo, index) => {
    const opt = document.createElement("option");
    opt.value = `personalizado-${index}`;
    opt.textContent = `${icones[modelo.categoria] || ""} ${modelo.nome}`;
    seletor.appendChild(opt);
  });
}

function gerarMensagemCadastro() {
  const nome = document.getElementById("nome").value.trim() || "{NOME}";
  const valor = document.getElementById("valor").value.trim() || "{VALOR}";
  const vencimento = document.getElementById("vencimento").value
    ? document.getElementById("vencimento").value.split("-").reverse().join("/")
    : "{VENCIMENTO}";
  const modelo = document.getElementById("modeloCadastro").value;

  let texto = "";

  if (modelo === "lembrete-padrao") {
    texto = `Ol√° ${nome}, sua mensalidade de R$ ${valor} vence em ${vencimento}.\nPIX: 11370535000170\nEnvie o comprovante para (73) 99927-2550`;
  } else if (modelo === "cobranca-formal") {
    texto = `Prezado(a) ${nome}, identificamos pend√™ncia na mensalidade de R$ ${valor}, vencida em ${vencimento}.\nSolicitamos a regulariza√ß√£o imediata.\nPIX: 11370535000170`;
  } else if (modelo === "cobranca-direta") {
    texto = `Ol√° ${nome}, sua mensalidade de R$ ${valor} venceu em ${vencimento}.\nPor favor, envie o comprovante via WhatsApp: (73) 99927-2550\nPIX: 11370535000170`;
  } else if (modelo.startsWith("personalizado-")) {
    const index = parseInt(modelo.split("-")[1]);
    const personalizados = JSON.parse(localStorage.getItem("modelosPersonalizados")) || [];
    if (personalizados[index]) {
      texto = personalizados[index].texto
        .replaceAll("{NOME}", nome)
        .replaceAll("{VALOR}", valor)
        .replaceAll("{VENCIMENTO}", vencimento);
    }
  }

  document.getElementById("mensagemCadastro").value = texto;
}

document.getElementById("modeloCadastro").addEventListener("change", gerarMensagemCadastro);

function enviarMensagemCadastro() {
  const whatsapp = onlyDigits(document.getElementById("whatsapp").value.trim());
  const texto = document.getElementById("mensagemCadastro").value;
  if (!whatsapp || !texto) {
    alert("Preencha o WhatsApp e a mensagem.");
    return;
  }
  const url = `https://wa.me/55${whatsapp}?text=${encodeURIComponent(texto)}`;
  window.open(url, "_blank");
}

// Inicializa√ß√£o ao carregar
window.onload = () => {
  const clientesSalvos = JSON.parse(localStorage.getItem("clientes")) || [];
  clientesSalvos.forEach(c => renderCliente(c.nome, c.valor, c.vencimento, c.whatsapp, c.tipo));

  const historicoSalvo = JSON.parse(localStorage.getItem("historico")) || [];
  historicoSalvo.forEach(h => renderHistorico(h.nome, h.valor, h.vencimento, h.whatsapp, h.tipo, h.data));

  carregarModelo();
  atualizarModelosCadastro();
  listarModelosPersonalizados();
};
</script>
</body>
</html>
